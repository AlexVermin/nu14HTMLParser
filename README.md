# nu15AutoRu
## Урок № 15

### Bot для Telegram + Парсер HTML.
В качестве источника данных служит сайт auto.ru
Бот позволяет задать пользователю фильтр по наиболее популярным (по данным сайта)
автомобиляи и их моделям; по году выпуска и стоимости;
задать тип автомобилей - новые / с пробегом / все; задать режим сортировки выводимых объявлений.

Объявления выводятся в виде:

    Название автомобиля  
    цена
    информация о двигателе
    информация о пробеге
    ссылка на объявление

Каждое объявление - в виде отдельного сообщения от бота.  

### Список команд бота
/start - начать работу с ботом  
/name - задать марку автомобиля для поиска  
/model - задать модель для поиска  
/year - задать фильтр по годам выпуска авто, границы бот запрашивает автоматически  
/price - задать фильтр по ценам, границы бот запрашивает автоматически  
/kind - задать тип автомобилей: новые/с пробегом/все  
/sort - задать режим сортировки  
/filter - показать установленные условия поиска  
/show - показать очередной блок сообщений с результатами поиска  
/show <page_no> - показать блок номер <page_no> с результатами поиска    
/clear - очистить параметры поиска  
/help - выводит это окно  

Для администратора список команд расширен ещё тремя:  

**/update - обновить список автомобилей и их моделей**, по которым доступны объявления на сайте.
Данная команда выполняется довольно продолжительное время, поэтому стоит запастись терпением.
Информация о популярных марках и их моделях сохраняется в файл, с тем,
чтобы сократить время отклика для пользователя.  
*К сожалению, не смог научиться получать полный список марок и моделей с сайта, поскольку на нём
эта информация выгружается с помощью JS, поэтому бот ограничен популярными марками и моделями.*
  
**/stat_auto - показать статистику по загруженной информации об автомобилях**  
**/stat_user - показать сколько пользователей пользовались ботом**  

### Необходимые настройки

Для работы необходимо в файл `./data/token.tlg` в текстовом виде сохранить:
* в первую строку - токен, полученный от TG для работы с ботом
* во вторую строку - ID пользователя, который будет считаться администратором
Без данных из этого файла бот не запустится.

### Прочее
Информация о настройках фильтров пользователей сохраняется в файл `./data/filters.list`  
Информация о популярных марках и моделях авто с сайта кэшируется в файл `./data/cars.list`

При повторных запусках бота, сохранённая информация восстанавливается в необходимые для работы стуктуры данных.

При запуске бот сначала пытается соединиться с сервером TG без использования прокси. Если возникает ошибка,
то используется адрес прокси, заданный `в строке 32 модуля main.py`.  